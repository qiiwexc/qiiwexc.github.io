function Set-MalwareProtectionConfiguration {
    try {
        Set-MpPreference -CheckForSignaturesBefore $True
        Set-MpPreference -DisableBlockAtFirstSeen $False
        Set-MpPreference -DisableCatchupQuickScan $False
        Set-MpPreference -DisableEmailScanning $False
        Set-MpPreference -DisableRemovableDriveScanning $False
        Set-MpPreference -DisableRestorePoint $False
        Set-MpPreference -DisableScanningMappedNetworkDrivesForFullScan $False
        Set-MpPreference -DisableScanningNetworkFiles $False
        Set-MpPreference -EnableFileHashComputation $True
        Set-MpPreference -EnableNetworkProtection Enabled
        Set-MpPreference -PUAProtection Enabled

        Set-MpPreference -AllowSwitchToAsyncInspection $True
        Set-MpPreference -DisableArchiveScanning $False
        Set-MpPreference -DisableBehaviorMonitoring $False
        Set-MpPreference -DisableDnsOverTcpParsing $False
        Set-MpPreference -DisableDnsParsing $False
        Set-MpPreference -DisableFtpParsing $False
        Set-MpPreference -DisableHttpParsing $False
        Set-MpPreference -DisableInboundConnectionFiltering $False
        Set-MpPreference -DisableIntrusionPreventionSystem $False
        Set-MpPreference -DisableIOAVProtection $False
        Set-MpPreference -DisableRdpParsing $False
        Set-MpPreference -DisableRealtimeMonitoring $False
        Set-MpPreference -DisableScriptScanning $False
        Set-MpPreference -DisableSmtpParsing $False
        Set-MpPreference -DisableSshParsing $False
        Set-MpPreference -DisableTlsParsing $False
        Set-MpPreference -IntelTDTEnabled 1
        Set-MpPreference -MeteredConnectionUpdates $True

        Set-MpPreference -BruteForceProtectionLocalNetworkBlocking $True

        Out-Success
    } catch {
        Out-Failure "Failed to apply malware protection configuration: $_"
    }
}
