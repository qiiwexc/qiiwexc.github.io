name: Deploy to GitHub Pages
description: Check for existing release and deploy build artifacts to GitHub Pages

outputs:
  tag:
    description: The tag being released
    value: ${{ steps.check.outputs.tag }}
  should_release:
    description: Whether a new GitHub release should be created
    value: ${{ steps.check.outputs.should_release }}
  page_url:
    description: The deployed GitHub Pages URL
    value: ${{ steps.deployment.outputs.page_url }}

runs:
  using: composite
  steps:
    - name: Check for existing release
      id: check
      shell: bash
      env:
        GH_TOKEN: ${{ github.token }}
        TAG: ${{ github.ref_name }}
      run: |
        if gh release view "$TAG" --repo "${{ github.repository }}" > /dev/null 2>&1; then
          echo "Release $TAG already exists, skipping"
          echo "should_release=false" >> $GITHUB_OUTPUT
          exit 0
        fi
        echo "tag=$TAG" >> $GITHUB_OUTPUT
        echo "should_release=true" >> $GITHUB_OUTPUT

    - name: Download build artifacts
      uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
      with:
        name: build-output
        path: .

    - name: Move build artifacts
      shell: bash
      run: mv public/favicon.ico ./ && mv build/* ./ && rm -r build

    - name: Setup Pages
      uses: actions/configure-pages@983d7736d9b0ae728b81ab479565c72886d7745b # v5.0.0

    - name: Upload artifact
      uses: actions/upload-pages-artifact@7b1f4a764d45c48632c6b24a0339c27f5614fb0b # v4.0.0
      with:
        path: .

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@d6db90164ac5ed86f2b6aed7e0febac5b3c0c03e # v4.0.5
